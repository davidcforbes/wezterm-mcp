# Repository Guidelines

This repo is a TypeScript MCP server for WezTerm. Use these notes to navigate, build, and contribute consistently.

## Project Structure & Module Organization

Source lives in `src/` (entry: `src/index.ts`; helpers like `src/wezterm_executor.ts`). Tests live in `tests/` using `*.test.ts` or `*.spec.ts`. `build/` is generated by `tsc` and is the published binary (`build/index.js`). Core config files include `package.json`, `tsconfig.json`, and `jest.config.js`, plus packaging assets like `Dockerfile` and `smithery.yaml`.

## Build, Test, and Development Commands

- `npm install`: install dependencies.
- `npm run build`: compile TypeScript into `build/` and mark the CLI executable.
- `npm run watch`: recompile on changes during development.
- `npm run inspector`: run the MCP inspector against `build/index.js`.
- `npm test`: run Jest once.
- `npm run test:watch`: re-run Jest on file changes.
- `npm run test:coverage`: enforce coverage and emit reports.

## Coding Style & Naming Conventions

Use 2-space indentation and ESM imports/exports (`type: module`). TypeScript runs in `strict` mode per `tsconfig.json`. File names use `snake_case` for modules, classes are `PascalCase`, and functions/variables are `camelCase`. No repo-wide formatter or linter is configured, so match existing formatting.

## Testing Guidelines

Tests run with Jest and `ts-jest` in a Node environment. Coverage thresholds are 70% for branches, functions, lines, and statements (see `jest.config.js`). Prefer unit tests in `tests/` that mirror the module name, for example `tests/wezterm_executor.test.ts`.

## Commit & Pull Request Guidelines

Commit history uses short, imperative, sentence-case subjects (for example, "Add Jest configuration"). Keep commits focused on one change when practical. PRs should include a concise summary, tests run, and links to related issues; call out any behavior changes that affect WezTerm or MCP clients.

## Configuration & Packaging

`Dockerfile` supports a multi-stage build for containerized usage. `smithery.yaml` is used for Smithery distribution and should be updated alongside release-ready changes.

## Landing the Plane (Session Completion)

**When ending a work session**, you MUST complete ALL steps below. Work is NOT complete until `git push` succeeds.

**MANDATORY WORKFLOW:**

1. **File issues for remaining work** - Create issues for anything that needs follow-up
2. **Run quality gates** (if code changed) - Tests, linters, builds
3. **Update issue status** - Close finished work, update in-progress items
4. **PUSH TO REMOTE** - This is MANDATORY:
   ```bash
   git pull --rebase
   bd sync
   git push
   git status  # MUST show "up to date with origin"
   ```
5. **Clean up** - Clear stashes, prune remote branches
6. **Verify** - All changes committed AND pushed
7. **Hand off** - Provide context for next session

**CRITICAL RULES:**
- Work is NOT complete until `git push` succeeds
- NEVER stop before pushing - that leaves work stranded locally
- NEVER say "ready to push when you are" - YOU must push
- If push fails, resolve and retry until it succeeds
